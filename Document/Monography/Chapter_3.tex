Given the complexity introduced by convective motions on the spectrum, this project takes a computational approach.
The analysis was conducted using the Python programming language.
All data and code have been uploaded in a \href{https://github.com/ccuellarn/Final-Project}{GitHub repository}, allowing anyone interested to reproduce and verify the authenticity of the results presented. 

This project follows the methodology established in previous studies (see~\cite{Dravins_1981} and references therein), utilizing a selected list of Fe I lines from Nave~\cite{Nave_1994}. 
As previously discussed, these lines are ideal for the calibration process due to their high abundance, minimal thermal broadening, limited isotopic variation and availability of accurate laboratory measurements of natural wavelengths.
\section{Computational approach}
The computational approach focuses on identifying the solar granulation patterns by calculating relative velocities from Fe I lines. 

First, Fe I lines in the IAG solar flux atlas and the IAG spatially resolved quiet Sun atlas using the Nave blend-free list of Fe I lines were identified~\cite{Nave_1994}.
For each identified line were selected bins of $\SI{0.1}{\angstrom}$ around the closest minimal point to the rest wavelength from the Nave Fe I list.
Beware, these points are not the observed wavelengths, just a reference to generate an observation window.

Then, a fourth-order polynomial fit was adjusted to the wavelength window; a second-order fit is clearly insufficient beacuse profiles are known to be assymetric and a third order fit is still inadequate.
We follow Allende and Prieto~\cite{Allende_Garcia_1998} approach for quantifying asymmetry via the bisector slope using a fourth-order polynomial fit, and the minimum of this polynomial as the observed wavelength. 
For an optimal fit a z-score standardization was applied to each line core, which is explained in appendix\ref{ap:zscore}.

The observed wavelength from the polynomial fit was used to calculate the relative velocity.
Finally, the second derivative of the polynomial for the line core curvature (see Equation~\eqref{eq:core curvature}) and the third derivative for the line core bisector slope (see Equation~\eqref{eq:third derivative relation}) were found.

To maintain consistency when comparing results with other authors, the visible and near infrared range given by Reiners et al.~was modified.
The visible range is now considered from $\SI{4000}{\angstrom}$ to $\SI{7500}{\angstrom}$; and the near infrared from $\SI{7500}{\angstrom}$ to $\SI{23000}{\angstrom}$.

\subsection{Statistical analysis}
The selection for the width of the window around the line core for analysis was not statistically justified in previous research.
This project presents several results for the statistical methodology accuracy.  

The variations of the observed wavelength was analyzed by altering the width of the window used for the fourth-order polynomial fit around the line core. 
Figure~\ref{fig:variance} shows that a window of $\SI{0.1}{\angstrom}$ performs well in the visible spectrum. 
However, its performance degrades in the infrared, where the number of data points defining the line core is reduced compared to a typical line in the visible range.
The values for the variance and the standard deviation in each wavelength give a level of accuracy in the obtained results.

To focus on the line core, limits were established based on a minimum distance from the core of and half of the bisector calculation window width. 
Specifically, the lower limit was defined as the observed wavelength $ \pm \SI{10}{\miliangstrom}$; and the upper limit, as the observed wavelength $\pm \SI{0.1}{\angstrom}$.
To discard velocity values inconsistent with the Sun's physical characteristics, a range of $-700$ m/s to $700$ m/s range was applied.

\begin{figure}[H]
     \centering
     \begin{subfigure}{0.95\textwidth}
         \includegraphics[width=\textwidth]{Images/Results/Statistics/variance std VIS.pdf}
         \caption{Visible range for the IAG solar flux atlas.}

     \end{subfigure}
\hfill
     \begin{subfigure}{0.95\textwidth}

         \includegraphics[width=\textwidth]{Images/Results/Statistics/variance std NIR.pdf}
         \caption{Near infrared range for the IAG solar flux atlas.}

     \end{subfigure}

        \caption{Variance and standard deviation for several observed wavelength altering the width of the window on the fourth-order polynomial fit.}\label{fig:variance}
\end{figure}

Subsequently, a linear fit was adjusted on the plot of observed against emitted wavelength for each window width, and the residuals were plotted to determine the standard deviation (see Figure~\ref{fig:variance VIS} and Figure~\ref{fig:variance NIR}). 
The goal was not find the closest value to the emitted wavelength, as this would neglect the Doppler effect.
The methodology for determining this optimal width was to select the value that minimized the variance of the residuals from a linear regression of observed against emitted wavelength. 
This approach ensures the consistency of the observed wavelength across the entire spectrum.

Figure~\ref{fig:residuals VIS} shows the residuals of the linear fit across the emitted wavelength for the visible range in the IAG solar flux atlas.
With some smaller window widths, a displacement along the wavelength is observed, indicating an inconsistency in the calculated observed wavelength.
However, the window width of $\SI{0.1}{\angstrom}$ shows consistent residuals across the wavelength range and consequently, a minimal variance.

This is confirmed in Figure~\ref{fig:optimal window VIS}, where the optimal window width is $\SI{0.1}{\angstrom}$, ensuring a minimal variance of $0.003$.

On the other hand, Figure~\ref{fig:residuals NIR} shows the plot of the linear fit residuals across emitted wavelength for the near infrared range in the IAG solar flux atlas.
In contrast to the visible range, there is no pronounced displacement along the emitted wavelength, which means there is no strong preference for any specific window width.
Figure~\ref{fig:optimal window NIR} confirms that there are various optimal widths with minimal variance to select.
For consistency with the analysis of the visible range, we used the same window width of $\SI{0.1}{\angstrom}$.
Even though this is not the absolute minimum, it ensures a consistent methodology with low variance of $0.002$.


This analysis validates the window width used by Allende and Garcia~\cite{Allende_Garcia_1998}, confirming their hypothesis of $\SI{0.1}{\angstrom}$ as the optimal window width for the Fe I lines in the solar spectrum.
For future work, this process could be formalized into an algorithm that dynamically determines the optimal width based on the specific noise characteristics and spectral features of the dataset.
\begin{figure}[H]
     \centering
     \begin{subfigure}{0.95\textwidth}
        \includegraphics[width=\textwidth]{Images/Results/Statistics/variance slopes VIS.pdf}
         \caption{Plot of the linear fit residuals against emitted wavelength, in smaller widths can be seen a displacement along wavelength.}\label{fig:residuals VIS}

     \end{subfigure}
\hfill
     \begin{subfigure}{0.95\textwidth}
        \includegraphics[width=\textwidth]{Images/Results/Statistics/optimal window VIS.pdf}
        \caption{Variance of the residuals for each window width, the minimum window width of $\SI{0.1}{\angstrom}$ ensures consistency along wavelength.}\label{fig:optimal window VIS}

     \end{subfigure}

        \caption{Plots of optimal width in the visible range for the IAG solar flux atlas.}\label{fig:variance VIS}
\end{figure}


\begin{figure}[H]
     \centering
     \begin{subfigure}{0.95\textwidth}
        \includegraphics[width=\textwidth]{Images/Results/Statistics/variance slopes NIR.pdf}
         \caption{Plot of the linear fit residuals against emitted wavelength, there is no pronounced displacement along the emitted wavelength.}\label{fig:residuals NIR}

     \end{subfigure}
\hfill
     \begin{subfigure}{0.95\textwidth}
        \includegraphics[width=\textwidth]{Images/Results/Statistics/optimal window NIR.pdf}
        \caption{Variance of each window width, the minimum point that ensures consistency along wavelength is the $\SI{0.1}{\angstrom}$ even if is not the absolute minimum point.}\label{fig:optimal window NIR}

     \end{subfigure}

        \caption{Plots of optimal width in the near infrared range for the IAG solar flux atlas.}\label{fig:variance NIR}
\end{figure}

\section{Blend-free Fe I line Nave list}
The mentioned method implements the Nave list of laboratory-measured Fe I lines~\cite{Nave_1994}, which presents laboratory measurements for wavelength and values for excitation potential. 
This list classifies lines with a quality grading ($A,B,C,D$), based on four wavenumber uncertainties $(\Delta \sigma)$ and the corresponding wavelength uncertainties $(\Delta \lambda)$.
Where $A$ denotes lines with error in wavenumbers less than $0.005$ $\text{cm}^{-1}$; grade $B$ less than $0.01$ $\text{cm}^{-1}$; grade $C$ less than $0.02$ $\text{cm}^{-1}$; and grade $D$ greater than $0.02$ $\text{cm}^{-1}$.
All known blended lines and all lines measured only in grating spectra have been assigned the grade $D$~\cite{Nave_1994}.

However, not all the cataloged lines with grade $A$ are clearly present in the solar spectrum, and in the blue and the near infrared range, many lines are severely blended.
In collaboration with Professor Benjamin and Manuel Fuentes, we refined this initial list using different approaches to select the most reliable lines. 

\subsection{Selection process for blend-free Fe I lines}
The line selection process employed two approaches: Computational and manual.
Initially, only quality A lines for the Nave list were selected. 
This group were subjected to four computational filters based on the properties of having a fourth-order polynomial fit for the line core.

The first filter takes into account the form of the C-curved line profile bisector.
Lines whose core bisector profile exhibited excessive scatter, indicating a profile dominated by noise rather than a convective signature, were rejected.

The second filter selected lines whose curvature sign was consistent with an absorption line; this implies the coefficient of the fourth-order term needs to be positive. 

The third filter ensures the selected lines represents an absorption curve by discarding closest points that more closely resemble slopes or continuum noise.
The condition was keep lines which difference between extreme points of the fit were less than half of the line depth. 
This describe an absorption curve, and not a slope or noise.

The final filter required a comparision with the obtained third signature plot. 
Larger discrepancies suggest misidentification or severe blending, rendering the calculated relative velocity unreliable.
This threshold is empirically supported by observations throughout the selection process and the statement for the mean velocity of the sun varies from $-200$  m/s to $800$  m/s.

The final part of the selection process was a manual inspection to discard lines that were blended or absent from the solar spectrum. 
A custom visualizer (detailed in appendix\ref{ap:visualizer}) was instrumental for this process, allowing the simultaneous display of graphics related to dynamics aspects. 
This was particularly useful for selecting lines in the near infrared range.
The visual requirement focused on the geometry of the spectral line profile, its behavior on the three signatures plots. 

The concluding part of the method were performed the plots which represents the three signatures of convection.

First of all, the third signature plot, line core curvatures and line profile bisector slopes against line depth were plotted for all ranges in both atlases in order to observe the three signatures of convection.


